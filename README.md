# general_3x3

A wrapper for [meep code](https://meep.readthedocs.io/en/latest/) that generates a dataset of electric field data for 3x3 meta-atom pillars. The radii of the pillars are generated randomly from values within the 75 nm to 150 nm range (See [single pillar sim](https://github.com/Kovaleski-Research-Lab/single_pillar_sim) for reference).

The simulations are performed, as described in [this publication](https://www.spiedigitallibrary.org/conference-proceedings-of-spie/13042/1304206/Time-series-neural-networks-to-predict-electromagnetic-wave-propagation/10.1117/12.3013488.full), with the finite-difference time-domain (FDTD) method using an open-source software package5 for 3x3 configurations of high dielectric nanopillars, a class of meta-atom that enables wavefront modification for optical wavelengths.6 The pillar radii are randomly generated for values in the range of 75 nm to 250 nm. The simulations are performed with a resolution of 80 pixels/µm using Bloch periodic boundary conditions in the lateral directions and perfectly matched layers (PML) upstream and downstream.7 A model of the computational cell is shown in Fig. 1.A, where a Gaussian source, polarized in the Ey direction, is normally incident on the silicon nanopillars (n = 3.48) embedded in a layer of polydimethylsiloxane (PDMS) (n = 1.4) and situated on a fused silica substrate (n = 1.44). A single nanopillar lattice size is 680 nm. Extending this configuration to three nanopillars in both the x and y directions results in a lattice area of 2040 nm² for the neighborhood. The simulation outputs discrete Fourier transmormed (DFT) fields, which can be used to analyze electric fields to understand their spectral content while keeping the spatial dependence of the field intact. As the wave propagates in the z-direction and interacts with the nonuniform pillars, scattering occurs. To prevent any component of the scattered wave traveling in the x- or y-direction from contaminating the region of interest due to the periodic boundary, a buffer of 4000 nm is established in both the x and y directions, as presented in Fig. 1.B. To ensure the buffer distance is sufficient, consider the pulse length of the Gaussian source, represented by the time-bandwidth product, ∆t∆f ≈0.88. With the frequency width ∆f of the Gaussian source defined as 178.76 THz to account for wavelengths ranging from 1060 nm to 2881 nm, the pulse length ∆t, corresponding to the full width at half maximum, is approximately 4.9 fs. The time required for any component of the wave to propagate orthogonal to the z-direction and reach the nearest pillar in the periodic boundary is calculated based on the velocity of wave propagation through PDMS, which is 0.214 µm/fs. For a distance of 4 µm, approximately 18.6 fs is needed, corresponding to 3.8 pulse lengths. Hence, establishing a buffer region extending 4 µm (4000 nm) in both the x and y directions guarantees the meaningful propagation of the wave through and beyond the pillars, such that the DFT fields in the region of interest are collected without contamination arising from the periodic boundaries.

## Folder descriptions

- [kubernetes folder](https://github.com/Kovaleski-Research-Lab/general_3x3/tree/andy_branch/kubernetes) : contains files for generating data and reducing data (reducing raw data to volumes) via kubernetes. Data transfer via rclone is also supported.
- [configs folder](https://github.com/Kovaleski-Research-Lab/meta_atom_rnn/tree/main/configs) : contains the configuration (.yaml) file for the entire pipeline, including a flag `deployment_mode` which gives the user the option to develop locally (via [Docker](https://hub.docker.com/layers/kovaleskilab/meep/v3_lightning/images/sha256-e550d12e2c85e095e8fd734eedba7104e9561e86e73aac545614323fda93efb2?context=repo)) with a limited dataset, or using the Nautilus cluster via Kubernetes. The config file also contains a parameter called `task`, which allows the user to either generate raw data or preprocess (reduce) the raw data. Additionally, the config file contains paths, and meep parameters.
- [Preprocess_data folder](https://github.com/Kovaleski-Research-Lab/meta_atom_rnn/tree/main/preprocess_data) : contains a script that takes in volumes of DFT electric field data from meep simulations and conditions them for the time series networks here.
- [main.py](https://github.com/Kovaleski-Research-Lab/meta_atom_rnn/blob/main/main.py) is the script we run for all processes if we are developing locally. If we're training locally, `train.sh` automates the experiments.
  - Run `main.py -config configs/params.yaml`. Make sure configs/params.yaml is correct for your preferred deployment_mode and experiment, as well as network training parameters, paths, etc.
- [Utils folder](https://github.com/Kovaleski-Research-Lab/meta_atom_rnn/tree/main/utils) : contains all our implementations of time series networks using PyTorch lightning, as well as helper functions for data processing, building plots, etc.
